<!-- templates/edit_test.html -->
{% extends "base.html" %}

{% block title %}Edit Test - {{ test.name }}{% endblock %}

{% block content %}
  <h1 class="my-4">Edit Test - {{ test.name }}</h1>
  <form method="post">
    {{ form.hidden_tag() }}
    <div class="form-group">
      {{ form.test_name.label }}
      {{ form.test_name(class="form-control") }}
    </div>
    <div class="form-group">
      {{ form.time_limit.label }}
      {{ form.time_limit(class="form-control") }}
    </div>
    <div class="form-group">
      {{ form.test_content.label }}
      {{ form.test_content(class="form-control", id="test_content") }}
    </div>
    {{ form.submit(class="btn btn-primary") }}
    <a href="{{ url_for('index') }}" class="btn btn-link">Back to Home</a>
  </form>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <!-- CKEditor 5 Classic Editor -->
  <script src="https://cdn.ckeditor.com/ckeditor5/35.3.0/classic/ckeditor.js"></script>

  <script>
    // Initialize CKEditor
    ClassicEditor.create(document.querySelector('#test_content'))
      .then(editor => {
          window.editor = editor; // Save the editor instance for later use
          editor.setData(document.querySelector('#test_content').value); // Set existing data
      })
      .catch(error => {
          console.error(error);
      });

    // Ensure CKEditor updates the textarea before form submission
    document.querySelector('form').addEventListener('submit', function(e) {
      document.querySelector('#test_content').value = window.editor.getData();
    });
  </script>
{% endblock %}
