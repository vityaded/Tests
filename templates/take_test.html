
{% extends "base.html" %}

{% block title %}Take Test - {{ test.name }}{% endblock %}

{% block content %}
  <h1 class="my-4">{{ test.name }}</h1>

  {% if time_limit %}
    <div class="alert alert-info" id="timer">
      Time Remaining: <span id="time">Loading...</span>
    </div>
  {% endif %}

  <form method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}"/>
   
    
    {% for line in processed_content %}
      <p>{{ line | safe }}</p>
    {% endfor %}
    <button type="submit" class="btn btn-primary">Submit Test</button>
</form>

  {% if score is not none %}
    <h2 class="my-4">Your Score: {{ score }} / {{ total }}</h2>
  {% endif %}

  <a href="{{ url_for('index') }}" class="btn btn-link">Back to Home</a>
{% endblock %}

{% block scripts %}
  {{ super() }}
  {% if time_limit %}
  <script>
    var timeLimit = {{ time_limit|default('null')|tojson }};
    if (timeLimit !== null) {
      var endTime = new Date().getTime() + timeLimit * 60 * 1000;
      var x = setInterval(function() {
        var now = new Date().getTime();
        var distance = endTime - now;

        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);

        document.getElementById("time").innerHTML = minutes + "m " + seconds + "s ";

        if (distance <= 0) {
          clearInterval(x);
          document.querySelector("form").submit();
        }
      }, 1000);
    } else {
      document.getElementById("timer").style.display = 'none';
    }
  </script>
  {% endif %}
{% endblock %}
